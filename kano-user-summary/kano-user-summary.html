<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../kano-progress-bar/kano-progress-bar.html">

<!--
`kano-user-summary` is a simple thumbnail user display for the kano-nav

Example:

    <kano-user-summary user="[[user]]"></kano-user-summary>
    <kano-user-summary user="[[user]]" default-avatar="/my-default-avatar.png"></kano-user-summary>

@group Kano Elements
@hero hero.svg
@demo ./kano-user-summary/demo/kano-user-summary.html

-->

<dom-module is="kano-user-summary">
    <style>
        :host {
            --dark-grey: var(--color-stone);
            --kano-progress-bar-bg-color: var(--color-black);
            --kano-progress-bar-color:  var(--color-green);
            --kano-progress-bar-main: {
                height: 7px;
            }
            display: block;
            box-sizing: border-box;
            font-size: 14px;
            height: 100%;
        }
        :host * {
            box-sizing: border-box;
        }
        :host .content {
            @apply --layout-flex;
            @apply --layout-horizontal;
            @apply --layout-justified;
            height: 100%;
        }
        :host .thumbnail {
            flex: 1 0 auto;
        }
        :host .avatar {
            height: auto;
            max-height: 100%;
            max-width: 40px;
            width: 100%;
        }
        :host .user {
            @apply --layout-flex;
            @apply --layout-vertical;
            @apply --layout-around-justified;
            padding-left: 20px;
        }
        :host .content.red .user,
        :host .content.grey .user {
            color: #ffffff;
        }
        :host .content.white .user {
            color: var(--dark-grey);
        }
        :host .user-main {
            @apply --layout-flex-2;
            @apply --layout-horizontal;
            @apply --layout-justified;
            @apply --layout-end;
            
        }
        :host .username {
            font-weight: bold;
            padding-right: 35px;
            width: 100%;
            color: var(--color-grey);
            white-space: nowrap;
        }
        :host .user-main {
            width: 100%;
        }
        :host .user-progress {
            @apply --layout-flex;
            @apply --layout-vertical;
            @apply --layout-start-justified;
            padding-top: 4px;
        }
        :host .user-progress:focus,
        :host .user-progress:hover {
            @apply --layout-flex;
            @apply --layout-horizontal;
            @apply --layout-start;
        }
        @media all and (max-width: 768px) {
            :host .user {
                display: none;
            }
        }
    </style>
    <template>
        <div class$="[[_computeClass(colorScheme)]]">
            <div class="thumbnail">
                <img src="[[avatar]]" class="avatar" />
            </div>
            <div class="user">
                <div class="user-main">
                    <div class="username">
                        Level [[level]]
                    </div>
                </div>
                <div class="user-progress">
                    <kano-progress-bar id="bar" min="0" max="100" display-label>
                    </kano-progress-bar>
                </div>
            </div>
        </div>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'kano-user-summary',
        properties: {
            /**
             * Source of the user's avatar
             */
            avatar: {
                type: String
            },
            /**
             * The current color-scheme required
             */
            colorScheme: {
                type: String,
                value: 'black'
            },
            /**
             * User level
             */
            level: {
                type: Number
            },
            /**
             * Current progress of the user fomr 0 to 1 until the next level
             */
            progress: {
                type: Number,
                notify: true,
                observer: '_updateBar'
            },
        },
        _computeClass (color) {
            var baseClass = 'content',
                activeClass = color;
            return baseClass + ' ' + activeClass;
        },
        _updateBar (currentProgress, previousProgress) {
            if (previousProgress) {
                let difference = currentProgress.current - previousProgress.current;
                this.$.bar.addValue(difference);
            }
        }
    });
</script>
